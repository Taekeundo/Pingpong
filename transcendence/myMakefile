#ENV_FILE = srcs/.env

# DATA_DIR = /home/sde-silv/data

all: compose

$(DATA_DIR):
# 	mkdir -p requirements/volumes
# 	mkdir -p requirements/volumes/wordpress
# 	mkdir -p requirements/volumes/mariadb


# compose: $(ENV_FILE) $(DATA_DIR)
compose:
	@docker compose -f docker-compose.yml up --build -d
	docker ps | wc -l

up: compose

down: stop
	@-read -p "Are you sure? [y/N] " ans && ans=$${ans:-N} ;\
    if [ $${ans} = y ] || [ $${ans} = Y ]; then\
        printf "cleaning images and volumes...\n" ;\
		docker compose -f docker-compose.yml down ;\
		docker volume prune -af ;\
		docker volume rm transcendence_shared-data ;\
		docker system prune -a -f ;\
    else\
        printf "...cleaning aborted\n" ;\
    fi

start:
	docker compose -f docker-compose.yml start

stop:
	@-docker ps | wc -l
	docker compose -f docker-compose.yml stop
	@-docker ps | wc -l

clean: stop

fclean: stop down

status:
	docker compose -f docker-compose.yml ps

.PHONY: all compose up down start stop clean fclean status log
