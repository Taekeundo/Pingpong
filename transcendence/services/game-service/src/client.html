<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ping Pong Game Client</title>
<style>
  body { background: #222; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
  canvas { background: #000; display: block; }
</style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="400"></canvas>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// Scale game units to canvas
// Game coordinates: x from -50 to +50 (100 units wide), y from -100 to +100 (200 units tall)
const boardWidth = 100;   // Total width: -50 to +50
const boardHeight = 200;  // Total height: -100 to +100
const scaleX = canvas.width / boardWidth;   // 800/100 = 8 pixels per game unit
const scaleY = canvas.height / boardHeight; // 400/200 = 2 pixels per game unit

let gameState = null;

const ws = new WebSocket('ws://localhost:3002/game-ws');

ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  if (data.type === 'STATE_UPDATE') {
    gameState = data.gameState;
    draw(); // Draw immediately on server update
  }
};

// Draw function
function draw() {
  if (!gameState) return;

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Draw center line
  ctx.strokeStyle = '#555';
  ctx.setLineDash([5, 5]);
  ctx.beginPath();
  ctx.moveTo(canvas.width/2, 0);
  ctx.lineTo(canvas.width/2, canvas.height);
  ctx.stroke();
  ctx.setLineDash([]);

  // Paddle settings
  const paddleHeight = 40 * scaleY;  // 40 game units * 2 pixels/unit = 80 pixels
  const paddleWidth = 2 * scaleX;    // 2 game units * 8 pixels/unit = 16 pixels
  
  // Paddle positions in game coordinates, then convert to canvas coordinates
  const leftPaddleX = -48;   // Game coordinate: near left edge (-50)
  const rightPaddleX = 48;   // Game coordinate: near right edge (+50)
  
  // Convert game coordinates to canvas coordinates
  const paddleXLeft = (leftPaddleX + 50) * scaleX;   // Convert -48 to canvas pixels
  const paddleXRight = (rightPaddleX + 50) * scaleX; // Convert +48 to canvas pixels

  // Left paddle (player1)
  const paddleY1 = canvas.height/2 - gameState.paddles.player1 * scaleY - paddleHeight/2;
  ctx.fillStyle = 'white';
  ctx.fillRect(paddleXLeft, paddleY1, paddleWidth, paddleHeight);

  // Right paddle (player2)
  const paddleY2 = canvas.height/2 - gameState.paddles.player2 * scaleY - paddleHeight/2;
  ctx.fillStyle = 'white';
  ctx.fillRect(paddleXRight, paddleY2, paddleWidth, paddleHeight);

  // Ball - use server data directly at 60 FPS
  const ballRadius = 2 * scaleY;
  const ballX = canvas.width/2 + gameState.ball.x * scaleX;
  const ballY = canvas.height/2 - gameState.ball.y * scaleY;
  ctx.beginPath();
  ctx.arc(ballX, ballY, ballRadius, 0, Math.PI*2);
  ctx.fillStyle = 'red';
  ctx.fill();

  // Scores
  ctx.fillStyle = 'white';
  ctx.font = '20px Arial';
  ctx.fillText(gameState.score.player1, canvas.width/4, 30);
  ctx.fillText(gameState.score.player2, 3*canvas.width/4, 30);
}

// Paddle control - both players
document.addEventListener('keydown', (e) => {
  let player = null;
  let direction = 0;
  
  // Player 1 controls (WASD)
  if (e.key === 'w' || e.key === 'W') {
    player = 'player1';
    direction = 'up';
  }
  if (e.key === 's' || e.key === 'S') {
    player = 'player1';
    direction = 'down';
  }
  
  // Player 2 controls (Arrow keys)
  if (e.key === 'ArrowUp') {
    player = 'player2';
    direction = 'up';
  }
  if (e.key === 'ArrowDown') {
    player = 'player2';
    direction = 'down';
  }
  
  // Send movement command
  if (player && direction) {
    ws.send(JSON.stringify({ type: 'MOVE_PADDLE', player, direction }));
  }
});

</script>
</body>
</html>
